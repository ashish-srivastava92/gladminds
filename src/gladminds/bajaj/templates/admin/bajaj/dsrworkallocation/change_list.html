



<script src="/static/js/1.10.3_jquery-ui.js" type="text/javascript"></script>

    <script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
  	<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" media="all"/>
  	<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
  	<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment-with-locales.js"></script>
  	
  	<script src="https://cdn.rawgit.com/Eonasdan/bootstrap-datetimepicker/e8bddc60e73c1ec2475f827be36e1957af72e2ea/src/js/bootstrap-datetimepicker.js"></script>
  	
  	
  	
	<link rel="stylesheet" type="text/css" href="/static/css/fullcalendar.print.css" media="all"/>
	<link rel="stylesheet" type="text/css" href="/static/css/fullcalendar.css" media="all"/>
	<link href="//cdn.rawgit.com/Eonasdan/bootstrap-datetimepicker/e8bddc60e73c1ec2475f827be36e1957af72e2ea/build/css/bootstrap-datetimepicker.css" rel="stylesheet">


    <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>

<script type="text/javascript" src="/static/js//portal/fullcalendar.js"></script>
<script type="text/javascript" src="/static/js/portal/fullcalendar.min.js"></script>
<script type="text/javascript">
	$(document).ready(function() {
	
		$("#submit").click(function(){
			var dsr=$('#dsrID').val();
			var retailer=$('#retailerID').val();
			var dateTime=$('#datetimepicker1 input').val();
			alert("DSR-"+dsr+","+"Retailer-"+retailer+","+"dateTime-"+dateTime);
			$.ajax({

			url : "http://local.bajaj.gladminds.co:8001/admin/bajaj/dsrworkallocation/",
			type:"post",
			data:'dsr='+dsr+'&retailer='+retailer+'&dateTime='+dateTime,
			success : function(data) {
				alert("done");
			}
			});
			
		});
		$.ajax({

			url : "{% url 'cal_data' %}",
			success : function(data) {
				// alert(data);
				
				var date = new Date();
				var d = date.getDate();
				var m = date.getMonth();
				var y = date.getFullYear();
				var eventsArray = new Array();
				for (var eachRow in data) {
					dict = {};
					dict['title'] = data[eachRow].title, dict['start'] = data[eachRow].date, dict['id'] = data[eachRow].id, dict['allDay'] = false, eventsArray.push(dict);
				}
				$('#calendars').fullCalendar({
					header : {
						left : 'prev,next today',
						center : 'title',
						right : 'month,agendaWeek,agendaDay'
					},
					selectable: true,
			        selectHelper: true,
			 		select: function(start, end) {
			 			// var select = document.createElement("select");
			 			// alert("i");
			 			alert(start);
			 			
var date = new Date(start);
// var day = date.getDate();
// var monthIndex = date.getMonth()+1;
// var year = date.getFullYear();


			 			$("#myModal").modal("show");
			 			$('#datetimepicker1').datetimepicker();
			 			$('#datetimepicker1 input').val(formattedDate(date)+" "+"12:00 AM");

						
					},
					buttonText : {
						today : 'Today',
						day : 'Day',
						month : 'Month',
						week : 'Week',

					},
					editable : true,
					events : eventsArray,
					backgroundColor : 'red',
					timeFormat : 'HH:mm',
				});
		
         // for (var i = 0 ; i < data.length; i++) {
          	
			var dsrObjs = data[0];
			
			   $('<option/>').val("0").html("Select DSR").appendTo('#dsrID');
			   $('<option/>').val("0").html("Select Retailer").appendTo('#retailerID');
			   
			for (var i=0;i<dsrObjs.length;i++){
			   $('<option/>').val(dsrObjs[i].id).html(dsrObjs[i].firstname).appendTo('#dsrID');
			}
				
			var retailerObjs = data[1];
			
			for (var i=0;i<retailerObjs.length;i++){
			   $('<option/>').val(retailerObjs[i].id).html(retailerObjs[i].location+" ("+retailerObjs[i].firstname+")").appendTo('#retailerID');
			}
			
			
			
          	
		//};
			}
		});


		

	});
	
function formattedDate(date) {
    var d = new Date(date || Date.now()),
        month = '' + (d.getMonth() + 1),
        day = '' + d.getDate(),
        year = d.getFullYear();

    if (month.length < 2) month = '0' + month;
    if (day.length < 2) day = '0' + day;

    return [day, month, year].join('/');
}
</script>



<style>
	#calendars {

		width: 900px;
		margin: 0 auto;
	}

</style>


	


<br/>
{% block content %}
<div id="calendars">

</div>

<!-- Modal -->
  <div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Schedule DSR</h4>
        </div>
        <div class="modal-body">
			         
			<div class="row form-group">
			  <div class="col-lg-4"><label for="dsrID">Select DSR: </label></div>
			  <div class="col-lg-8"><select id="dsrID" name="dsrID" class="form-control"></select></div>
			</div>         
			   
			<div class="row form-group">
			  <div class="col-lg-4"><label for="retailerID">Select Retailer: </label></div>
			  <div class="col-lg-8"><select id="retailerID" name="retailerID" class="form-control"></select></div>
			</div>
			   
			<div class="row form-group">
			  <div class="col-lg-4"><label for="retailerID">Select Date: </label></div>
			  <div class="col-lg-8">

				
			    <div class="form-group">
			        <div class='input-group date' id='datetimepicker1'>
			            <input type='text' class="form-control" />
			            <span class="input-group-addon">
			                <span class="glyphicon glyphicon-calendar"></span>
			            </span>
			        </div>
			    </div>


			  </div>
			</div>
			
			
			
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" id="submit">Submit</button>
        </div>
      </div>
      
    </div>
  </div>
  


{% endblock %}

