{% extends "base_template.html" %}

{% block style %}
<link href="/static/css/portal.css" rel="stylesheet">


<script type="text/javascript" src="{% url 'admin:jsi18n' %}"></script>
<script src="/static/js/1.10.3_jquery-ui.js" type="text/javascript"></script>

    <script src="http://code.jquery.com/jquery-1.9.1.js"></script>
  <link rel="stylesheet" type="text/css" href="/static/suit/bootstrap/css/bootstrap.min.css" media="all"/>
  <script src="/static/suit/bootstrap/js/bootstrap.min.js"></script>
    <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>


  <!-- <link rel="stylesheet" type="text/css" href="/static/suit/css/suit.css" media="all"> -->
  <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />

<style>
	.table-data {
		position : absolute;
	}
</style>
    <script>
      $(function() {
  	
  
    $( ".datepick" ).datepicker();
  });
  </script>
  <style>
  	.text-center {
  		text-align : center;
  	}
  </style>
{% endblock %}
{% block header %}
      <div class="navbar navbar-style">
        <div class="navbar-inner">
           <a class="brand" href="#"><img src="/static/{{METAINFO.logo}}" class='brand-logo logo-size'></a>
              <ul class="nav pull-right">
                 <li class="dropdown style-username">
                 	<a href="#" class="dropdown-toggle" id="userData" value={{user.username}} data-toggle="dropdown">{{user.first_name}}, {{user.username}}<b class="caret"></b></a>
                    <ul class="dropdown-menu pull-right">
                       <li><a href="{% url 'admin:password_change' %}">Change Password</a></li>
                       <li><a href="/admin/logout">Logout</a></li>
                   </ul>
                </li>
             </ul>
        </div>
      </div>
    {% endblock %}
{% block body  %}


<p><b>Order ID:{{order_id}}</b></p>
<p><b> Ordered Date:{{ordered_date}}</b></p>

 <form action="{% url 'save_order_history' %}" method="POST" enctyype="multipart/form-data">
	<table class="table table-striped table-bordered table-responsive	" >
        <thead>
				<tr>
					<th> </th>
				    <th class="text-center">PartNumber</th>
				    	 <th class="text-center">Available Qty</th>
					<th class="text-center">Ordered Qty</th>
					<th class="text-center">MRP</th>
					<th class="text-center">Line Total</th>
					{% if order_status == "pending" %}
				    <th class="text-center">Delivery Qty</th>			
				    <th class="text-center">Shipped date</th>
				    {% endif %}
				    
				</tr>
				
			</thead>
			
			
        <tbody>
        	
        	<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
				{% for each in data %}
	
		<tr style="background-color:red"> 

					<td> <input type="checkbox" class="chk-box" value="" rel="{{each.part_number}}"/></td>
{% if order_status == "shipped" %}
					<td class="text-center"><a  data-toggle="modal" data-target="#myModal" href="javascript:void(0)" onclick="loadOrderDetails('{% url 'ordered_part_details' each.part_number order_id %}','{{each.part_number}}','{{each.part_description}}')">{{each.part_number}}</a></td>
					
	{% endif %}
	{% if order_status == "pending" or order_status == "open" %}
	<td class="text-center">{{each.part_number}}</td>			
	
	
	{% endif %}
					<td class="text-center">{{each.available_quantity}}</td>
					<td class="text-center">{{each.quantity}}</td>
					<td class="text-center">{{each.mrp}}</td>
					<td class="text-center">{{each.line_total}}</td>
		
					{% if order_status == "pending" %}
					<td class="text-center"><input type ="text" required="true"  autocomplete="off" style="width:50px;text-align:center;" class="delivered-stock" name="delivered_stock" /></td>
			
					<td class="text-center">
						<input type="text" required="true" autocomplete="off" style="width:100px;text-align:center;" class="datepick" name="delivered_date" />
						</td>
	   				 {% endif %}
				</tr>
				
			
					</tbody>
				
					{% endfor %}
				   <input type="hidden" id="order_id"  name="order_id" value='{{order_id}}' > 
						<input type="hidden" id="orders_length" value='{{orders_length}}' name="orders_length"  > 
		</table>
	
		{% if order_status == "pending" %}
		<button type="submit" class="btn btn-primary" name="submit" id="_savesubmit">

						Submit 
		</button>
		{% endif %}
		{% if order_status == "open" %} 
		<button type="submit" class="btn btn-primary" name="cancel" id="_cancelsubmit">

						Cancel 
		
			{% endif %}
		
 </form>
 <script>

	$(document).ready(function() {
		$('.chk-box').change(function(e)	{
			if( $(this).is(":checked") ) {
					$(e.target).parents('tr').find('input.delivered-stock').attr('disabled', false).focus();
					$(e.target).parents('tr').find('input.datepick').attr('disabled', false);
					$(e.target).parents('tr>td').append("<input type='hidden' name='part_number' class='hiddentxt' value='"+$(this).attr("rel")+"'>")
					// $(e.target).parents('tr>td').append("<input type='hidden' name='part_number_ids' class='hiddentxt' value='"+$(this).attr("rel")+"'>")
			}
			else  {
					$(e.target).parents('tr').find('input.delivered-stock').attr('disabled', true);
					$(e.target).parents('tr').find('input.datepick').attr('disabled', true);
					$(e.target).parents('tr>td').find(".hiddentxt").remove();
			}
		});	

	});

	
	function loadOrderDetails(url, partNum, partDesc){
		alert(url);
		
		$("#part_numberHead").html(partNum);
		$("#part_desc").html(partDesc)
		$("#loadParts").attr("src",url);
	}
 </script>
 <!-- Modal -->
<div class="modal hide" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>

        <p class="modal-title"><strong>Order ID:</strong> <span>{{original.id}}</span><br/>       
        <strong>Part Number:</strong> <span id="part_numberHead"></span><br/>
        <strong>Part Description:</strong> <span id="part_desc"></span></span></p>
        
      </div>
      <div class="modal-body">
          <iframe src="" width="100%" id="loadParts" height="380" name= "part_details" frameborder="0" allowtransparency="true"></iframe>  
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
    <!-- /.modal-content -->
  </div>
  <!-- /.modal-dialog -->
</div>
<!-- /.modal -->
 {% endblock body  %}

