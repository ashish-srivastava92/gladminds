{% extends "admin/change_form.html" %}

{% load i18n admin_static admin_modify suit_tags admin_urls %}
{% load url from future %}
{% block extrahead %}
{{block.super}}
<!-- <link href="/static/css/portal.css" rel="stylesheet"> -->

<script type="text/javascript" src="{% url 'admin:jsi18n' %}"></script>

<link rel="stylesheet" type="text/css" href="/static/suit/bootstrap/css/bootstrap.min.css" media="all"/>
<link rel="stylesheet" type="text/css" href="/static/suit/css/suit.css" media="all">
<script src="/static/suit/js/jquery-1.8.3.min.js"></script>
<script type="text/javascript">
	var Suit = {
		$ : $.noConflict()
	};
	if (!$)
		$ = Suit.$;
</script>
<script src="/static/suit/bootstrap/js/bootstrap.min.js"></script>

<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>

<!-- <link rel="stylesheet" type="text/css" href="/static/suit/css/suit.css" media="all"> -->
<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />

<style>
	.table-data {
		position: absolute;
	}
</style>
<script>
	$(function() {

		$(".datepick").datepicker();
	}); 
</script>
<style>
	.text-center {
		text-align: center;
	}

</style>
{% endblock %}
{% block content %}

<p>
	<b>Order ID:{{order_id}}</b>
</p>
<p>
	<b> Ordered Date:{{ordered_date}}</b>
</p>


<form action="{% url 'accept_cancel_order' %}" method="POST" enctyype="multipart/form-data">



	<table class="table table-striped table-bordered table-responsive	" >
		<thead>
			<tr>
				{% if order_status == "open" %}
				<th></th>
{% endif %}

				<th class="text-center">PartNumber</th>
				<th class="text-center">Available Qty</th>
				<th class="text-center">Ordered Qty</th>
				<th class="text-center">MRP</th>
				<th class="text-center">Line Total</th>
				{% if order_status == "pending" %}
				<th class="text-center">Delivered Quantity</th>

				<th class="text-center">Delivery Qty</th>
				<th class="text-center">Shipped date</th>
				{% endif %}

			</tr>

		</thead>

		<tbody>
					{% for each in order_display %}

			{% if each.part_status == 1 %}
			<tr class="red">
				{% else %}
			<tr>
				{% endif %}

				{% if order_status == "open" or order_status == "pending" %}
				<td style="text-align:center">
				<input type="checkbox" class="chk-box" id="chk_{{each.part_number}}" value="" rel="{{each.part_number}}"/>
				</td>
				{% endif %}
	
				{% if order_status == "shipped" or order_status == "pending" %}
				<td class="text-center"><a data-toggle="modal" data-target="#myModal" href="javascript:void(0)" onclick="loadOrderDetails('{% url 'ordered_part_details' each.part_number order_id %}','{{each.part_number}}','{{each.part_description}}')">{{each.part_number}}</a> {% if order_status == "pending"  %}
				<input type="hidden" value="{{each.part_number}}" name="part_number">
				{% endif %} </td>
				{% endif %}
				{% if order_status == "open" or order_status == "cancelled" %}
				<td class="text-center">{{each.part_number}}</td>

				{% endif %}
				<td class="text-center">{{each.available_quantity}}</td>
				<td class="text-center">
				<input type="hidden" id="ordered_quantity"  name="ordered_quantity" value='{{each.quantity}}' >
				{{each.quantity}}</td>

				<td class="text-center">{{each.mrp}}</td>
				<td class="text-center">{{each.line_total}}</td>
					{% if order_status == "pending" %}
				<td class="text-center">
				<input type="hidden" id="delivered_quantity"  name="delivered_quantity" value='{{each.delivered_quantity}}' >
				{{each.delivered_quantity}}</td>
			
				<td class="text-center">
				<input type ="text" required="true"  autocomplete="off" style="width:50px;text-align:center;" class="delivered-stock" name="delivered_stock" />
				</td>

				<td class="text-center">
				<input type="text" required="true" autocomplete="off" style="width:100px;text-align:center;" class="datepick" name="delivered_date" />
				</td>
				{% endif %}
			</tr>

			{% endfor %}
		</tbody>

	</table>

	<input type="hidden" id="order_id"  name="order_id" value='{{order_id}}' >
	<input type="hidden" id="order_status" value='{{order_status}}' name="order_status"  >


	{% if order_status == "open" %}
	<button type="submit" class="btn btn-primary" name="place_order" id="_place_order_submit">
		Accept Part
	</button>
	<button type="submit" class="btn btn-primary"  name="cancel" id="_cancelsubmit">
		Cancel
	</button>
	{% endif %}

</form>
<script>
	$(document).ready(function() {
		$('.chk-box').change(function(e) {
			if ($(this).is(":checked")) {
				$(e.target).parents('tr').find('input.delivered-stock').attr('disabled', false).focus();
				$(e.target).parents('tr').find('input.datepick').attr('disabled', false);
				$(e.target).parents('tr>td').append("<input type='hidden' name='part_number' class='hiddentxt' value='" + $(this).attr("rel") + "'>")
				// $(e.target).parents('tr>td').append("<input type='hidden' name='part_number_ids' class='hiddentxt' value='"+$(this).attr("rel")+"'>")
			} else {
				$(e.target).parents('tr').find('input.delivered-stock').attr('disabled', true);
				$(e.target).parents('tr').find('input.datepick').attr('disabled', true);
				$(e.target).parents('tr>td').find(".hiddentxt").remove();
			}
		});

	});

	function loadOrderDetails(url, partNum, partDesc) {

		$("#part_numberHead").html(partNum);
		$("#part_desc").html(partDesc)
		$("#loadParts").attr("src", url);
	}
</script>
<!-- Modal -->
<div class="modal hide" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
					&times;
				</button>

				<p class="modal-title">
					<strong>Order ID:</strong><span>{{original.id}}</span>
					<br/>
					<strong>Part Number:</strong><span id="part_numberHead"></span>
					<br/>
					<strong>Part Description:</strong><span id="part_desc"></span></span>
				</p>

			</div>
			<div class="modal-body">
				<iframe src="" width="100%" id="loadParts" height="380" name="part_details" frameborder="0" allowtransparency="true"></iframe>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					Close
				</button>
			</div>
		</div>
		<!-- /.modal-content -->
	</div>
	<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<style>
	tr.red td {
		background-color: #F5D0A9 !important;
	}
</style>
{% endblock content  %}
